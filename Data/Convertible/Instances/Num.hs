#if ! (MIN_VERSION_Decimal(0,2,4))
{-# LANGUAGE StandaloneDeriving, DeriveDataTypeable #-}
#endif

{- |
   Module     : Data.Convertible.Instances.Num
   Copyright  : Copyright (C) 2009-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen <jgoerzen@complete.org>
   Stability  : provisional
   Portability: portable

Numeric instances for Convertible.

Copyright (C) 2009-2011 John Goerzen <jgoerzen@complete.org>

All rights reserved.

For license and copyright information, see the file LICENSE

These instances perform conversion between numeric types such as Double, Int, Integer,
Rational, and the like.  Here are some notes about the conversion process:

Conversions from floating-point types such as Double to integral types are done via the
'truncate' function.  This is a somewhat arbitrary decision; if you need different
behavior, you will have to write your own instance or manually perform the conversion.

All conversions perform bounds checking.  If a value is too large for its destination
type, you will get a 'ConvertError' informing you of this.  Note that this behavior
differs from functions in the Haskell standard libraries, which will perform the
conversion without error, but give you garbage in the end.

Conversions do not perform precision checking; loss of precision is implied with certain
conversions (for instance, Double to Float) and this is not an error.
-}

module Data.Convertible.Instances.Num()
where

import Data.Convertible.Base
import Data.Convertible.Utils
import Data.Int
import Data.Word
import Data.Decimal
import Data.Typeable
#if ! (MIN_VERSION_Decimal(0,2,4))
import Data.Ratio (denominator, numerator)
#endif
------------------------------------------------------------

{- The following instances generated by this code:

fp = ["Double", "Float", "Rational"]
int = ["Int", "Int8", "Int16", "Int32", "Int64", "Word", "Word8", "Word16", "Word32",
       "Word64"]
allItems l1 l2 = concatMap (\x -> map (\y -> (x, y)) int) fp
work = allItems fp int
printIt (f, i) = 
    "instance Convertible " ++ f ++ " " ++ i ++ " where \n\
    \    safeConvert = boundedConversion (return . truncate)\n\
    \instance Convertible " ++ i ++ " " ++ f ++ " where \n\
    \    safeConvert = return . fromIntegral\n"

main = mapM_ (putStrLn . printIt) work
-}

#if ! (MIN_VERSION_Decimal(0,2,4))
deriving instance Typeable1 DecimalRaw

-- The next code is copy-pasted from Decimal-0.2.4

decimalFromRational :: (Integral i) => Rational -> (DecimalRaw i)
decimalFromRational r = normalizeDecimal $ realFracToDecimal maxBound r

-- | Count the divisors, i.e. the count of 2 divisors in 18 is 1 because 18 = 2 * 3 * 3
factorN :: (Integral a)
           => a                  -- ^ Denominator base
           -> a                  -- ^ dividing value
           -> (a, a)             -- ^ The count of divisors and the result of division
factorN d val = factorN' val 0
  where
    factorN' 1 acc = (acc, 1)
    factorN' v acc = if md == 0
                     then factorN' vd (acc + 1)
                     else (acc, v)
      where
        (vd, md) = v `divMod` d

-- | Try to convert Rational to Decimal with absolute precision
-- return string with fail description if not converted
eitherFromRational :: (Integral i) => Rational -> Either String (DecimalRaw i)
eitherFromRational r = if done == 1
                       then do
                         wres <- we
                         return $ Decimal wres (fromIntegral m)
                       else Left $ show r ++ " has no decimal denominator"
  where
    den = denominator r
    num = numerator r
    (f2, rest) = factorN 2 den
    (f5, done) = factorN 5 rest
    e = max f2 f5
    m = num * ((10^e) `div` den)
    we = if e > (fromIntegral (maxBound :: Word8)) --  FIXME: will fail if DecimalRaw changed
         then Left $ show e ++ " is too big ten power to represent as Decimal"
         else Right $ fromIntegral e

-- | Reduce the exponent of the decimal numer to the minimal posible value
normalizeDecimal :: (Integral i) => (DecimalRaw i) -> (DecimalRaw i)
normalizeDecimal r = case eitherFromRational $ toRational r of
  Right x -> x
  Left e -> error $ "Imposible happened: " ++ e
#endif

instance Convertible Double Int where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int Double where
    safeConvert = return . fromIntegral

instance Convertible Double Int8 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int8 Double where
    safeConvert = return . fromIntegral

instance Convertible Double Int16 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int16 Double where
    safeConvert = return . fromIntegral

instance Convertible Double Int32 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int32 Double where
    safeConvert = return . fromIntegral

instance Convertible Double Int64 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int64 Double where
    safeConvert = return . fromIntegral

instance Convertible Double Word where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word Double where
    safeConvert = return . fromIntegral

instance Convertible Double Word8 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word8 Double where
    safeConvert = return . fromIntegral

instance Convertible Double Word16 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word16 Double where
    safeConvert = return . fromIntegral

instance Convertible Double Word32 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word32 Double where
    safeConvert = return . fromIntegral

instance Convertible Double Word64 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word64 Double where
    safeConvert = return . fromIntegral

instance Convertible Float Int where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int Float where
    safeConvert = return . fromIntegral

instance Convertible Float Int8 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int8 Float where
    safeConvert = return . fromIntegral

instance Convertible Float Int16 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int16 Float where
    safeConvert = return . fromIntegral

instance Convertible Float Int32 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int32 Float where
    safeConvert = return . fromIntegral

instance Convertible Float Int64 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int64 Float where
    safeConvert = return . fromIntegral

instance Convertible Float Word where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word Float where
    safeConvert = return . fromIntegral

instance Convertible Float Word8 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word8 Float where
    safeConvert = return . fromIntegral

instance Convertible Float Word16 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word16 Float where
    safeConvert = return . fromIntegral

instance Convertible Float Word32 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word32 Float where
    safeConvert = return . fromIntegral

instance Convertible Float Word64 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word64 Float where
    safeConvert = return . fromIntegral

instance Convertible Rational Int where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int Rational where
    safeConvert = return . fromIntegral

instance Convertible Rational Int8 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int8 Rational where
    safeConvert = return . fromIntegral

instance Convertible Rational Int16 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int16 Rational where
    safeConvert = return . fromIntegral

instance Convertible Rational Int32 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int32 Rational where
    safeConvert = return . fromIntegral

instance Convertible Rational Int64 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Int64 Rational where
    safeConvert = return . fromIntegral

instance Convertible Rational Word where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word Rational where
    safeConvert = return . fromIntegral

instance Convertible Rational Word8 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word8 Rational where
    safeConvert = return . fromIntegral

instance Convertible Rational Word16 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word16 Rational where
    safeConvert = return . fromIntegral

instance Convertible Rational Word32 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word32 Rational where
    safeConvert = return . fromIntegral

instance Convertible Rational Word64 where
    safeConvert = boundedConversion (return . truncate)
instance Convertible Word64 Rational where
    safeConvert = return . fromIntegral

-----------------------------------------------------------------

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Int where
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Int (DecimalRaw i) where
    safeConvert = return . fromIntegral

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Int8 where
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Int8 (DecimalRaw i) where
    safeConvert = return . fromIntegral

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Int16 where
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Int16 (DecimalRaw i) where
    safeConvert = return . fromIntegral

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Int32 where
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Int32 (DecimalRaw i) where
    safeConvert = return . fromIntegral

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Int64 where
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Int64 (DecimalRaw i) where
    safeConvert = return . fromIntegral

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Word where
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Word (DecimalRaw i) where
    safeConvert = return . fromIntegral

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Word8 where 
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Word8 (DecimalRaw i) where 
    safeConvert = return . fromIntegral

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Word16 where 
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Word16 (DecimalRaw i) where 
    safeConvert = return . fromIntegral

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Word32 where 
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Word32 (DecimalRaw i) where 
    safeConvert = return . fromIntegral

instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Word64 where 
    safeConvert = boundedConversion (return . truncate . toRational)
instance (Integral i, Typeable i, Show i) => Convertible Word64 (DecimalRaw i) where 
    safeConvert = return . fromIntegral

  

------------------------------------------------------------
{- The following instances generated by this code:

int = ["Int", "Int8", "Int16", "Int32", "Int64", "Word", "Word8", "Word16", "Word32",
       "Word64"]
allItems l1 l2 = concatMap (\x -> map (\y -> (x, y)) l1) l2
work = filter (\(a, b) -> a /= b) (allItems int int)
printIt (f, i) = 
    "instance Convertible " ++ f ++ " " ++ i ++ " where \n\
    \    safeConvert = boundedConversion (return . fromIntegral)\n"

printInteger i =
    "instance Convertible Integer " ++ i ++ " where \n\
    \    safeConvert = boundedConversion (return . fromIntegral)\n\
    \instance Convertible " ++ i ++ " Integer where \n\
    \    safeConvert = return . fromIntegral\n\n"

main = do mapM_ (putStrLn . printIt) work
          mapM_ (putStrLn . printInteger) int
-}

instance Convertible Int Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int Word where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int8 Int where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int8 Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int8 Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int8 Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int8 Word where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int8 Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int8 Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int8 Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int8 Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int16 Int where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int16 Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int16 Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int16 Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int16 Word where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int16 Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int16 Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int16 Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int16 Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int32 Int where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int32 Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int32 Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int32 Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int32 Word where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int32 Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int32 Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int32 Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int32 Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int64 Int where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int64 Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int64 Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int64 Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int64 Word where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int64 Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int64 Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int64 Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Int64 Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word Int where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word8 Int where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word8 Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word8 Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word8 Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word8 Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word8 Word where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word8 Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word8 Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word8 Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word16 Int where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word16 Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word16 Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word16 Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word16 Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word16 Word where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word16 Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word16 Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word16 Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word32 Int where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word32 Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word32 Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word32 Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word32 Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word32 Word where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word32 Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word32 Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word32 Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word64 Int where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word64 Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word64 Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word64 Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word64 Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word64 Word where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word64 Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word64 Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Word64 Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)

instance Convertible Integer Int where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Int Integer where 
    safeConvert = return . fromIntegral


instance Convertible Integer Int8 where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Int8 Integer where 
    safeConvert = return . fromIntegral


instance Convertible Integer Int16 where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Int16 Integer where 
    safeConvert = return . fromIntegral


instance Convertible Integer Int32 where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Int32 Integer where 
    safeConvert = return . fromIntegral


instance Convertible Integer Int64 where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Int64 Integer where 
    safeConvert = return . fromIntegral


instance Convertible Integer Word where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Word Integer where 
    safeConvert = return . fromIntegral


instance Convertible Integer Word8 where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Word8 Integer where 
    safeConvert = return . fromIntegral


instance Convertible Integer Word16 where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Word16 Integer where 
    safeConvert = return . fromIntegral


instance Convertible Integer Word32 where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Word32 Integer where 
    safeConvert = return . fromIntegral


instance Convertible Integer Word64 where 
    safeConvert = boundedConversion (return . fromIntegral)
instance Convertible Word64 Integer where 
    safeConvert = return . fromIntegral


------------------------------------------------------------

instance Convertible Integer Double where
    safeConvert = return . fromIntegral
instance Convertible Integer Float where
    safeConvert = return . fromIntegral
instance Convertible Integer Rational where
    safeConvert = return . fromIntegral
instance (Integral i, Typeable i, Show i) => Convertible Integer (DecimalRaw i) where
    safeConvert = return . fromIntegral
instance Convertible Double Integer where
    safeConvert = return . truncate
instance Convertible Float Integer where
    safeConvert = return . truncate
instance Convertible Rational Integer where
    safeConvert = return . truncate
instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Integer where
    safeConvert = return . truncate . toRational

instance Convertible Float Double where
    safeConvert = return . realToFrac
instance Convertible Double Float where
    safeConvert = return . realToFrac
instance Convertible Float Rational where
    safeConvert = return . toRational
instance Convertible Rational Float where
    safeConvert = return . fromRational
instance Convertible Double Rational where
    safeConvert = return . toRational
instance Convertible Rational Double where
    safeConvert = return . fromRational
instance (Integral i, Typeable i, Show i) => Convertible Float (DecimalRaw i) where
#if MIN_VERSION_Decimal(0,2,4)
    safeConvert = return . realToFrac
#else
    safeConvert = return . decimalFromRational . toRational
#endif
instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Float where
    safeConvert = return . realToFrac
instance (Integral i, Typeable i, Show i) => Convertible Double (DecimalRaw i) where
#if MIN_VERSION_Decimal(0,2,4)
    safeConvert = return . realToFrac
#else
    safeConvert = return . decimalFromRational . toRational
#endif
instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Double where
    safeConvert = return . realToFrac
instance (Integral i, Typeable i, Show i) => Convertible Rational (DecimalRaw i) where
#if MIN_VERSION_Decimal(0,2,4)
    safeConvert = return . fromRational
#else
    safeConvert = return . decimalFromRational . toRational
#endif
instance (Integral i, Typeable i, Show i) => Convertible (DecimalRaw i) Rational where
    safeConvert = return . toRational

------------------------------------------------------------
instance Convertible Char Integer where
    safeConvert = return . fromIntegral . fromEnum
instance Convertible Integer Char where
    safeConvert = boundedConversion (return . toEnum . fromIntegral)

------------------------------------------------------------
{- These instances generated by:

int = ["Int", "Int8", "Int16", "Int32", "Int64", "Word", "Word8", "Word16", "Word32",
       "Word64"]
printIt i = 
    "instance Convertible Char " ++ i ++ " where \n\
    \    safeConvert = boundedConversion (return . fromIntegral . fromEnum)\n\
    \instance Convertible " ++ i ++ " Char where \n\
    \    safeConvert = boundedConversion (return . toEnum . fromIntegral)\n\n"

main = do mapM_ (putStrLn . printIt) int
-}

instance Convertible Char Int where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Int Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Char Int8 where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Int8 Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Char Int16 where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Int16 Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Char Int32 where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Int32 Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Char Int64 where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Int64 Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Char Word where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Word Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Char Word8 where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Word8 Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Char Word16 where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Word16 Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Char Word32 where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Word32 Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Char Word64 where 
    safeConvert = boundedConversion (return . fromIntegral . fromEnum)
instance Convertible Word64 Char where 
    safeConvert = boundedConversion (return . toEnum . fromIntegral)


instance Convertible Integer Integer where
    safeConvert = return . id
